import{html,render}from"../../../../lib/lit-extended.js";import{repeat}from"../../../../lib/repeat.js";class ZcuiWcDateTimePicker extends HTMLElement{static get observedAttributes(){return["max-date-time","min-date-time","interval-in-min","time","ends","default-starts","default-ends"]}constructor(){super(),this.openMonthList=this.openYearList=this.openStartTimeList=this.openEndTimeList=!1,this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],this.monthRangeVal=[0,1,2,3,4,5,6,7,8,9,10,11],this.yearRangeVal=[2018],this.calendarWeekDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],this.disableNextMonth=this.disablePrevMonth=!1,this.showDateTimePicker=!1,this.updateShadowDom=this.updateShadowDom.bind(this),this.toggleOpenMonthList=this.toggleOpenMonthList.bind(this),this.toggleOpenYearList=this.toggleOpenYearList.bind(this),this.toggleOpenStartTimeList=this.toggleOpenStartTimeList.bind(this),this.toggleOpenEndTimeList=this.toggleOpenEndTimeList.bind(this),this._flipPage=this._flipPage.bind(this),this.setNextMonth=this.setNextMonth.bind(this),this.setPrevMonth=this.setPrevMonth.bind(this),this._updateMonthRange=this._updateMonthRange.bind(this),this.closeDropDowns=this.closeDropDowns.bind(this),this._checkDisabledNextPrevArrow=this._checkDisabledNextPrevArrow.bind(this),this.isValidDate=this.isValidDate.bind(this),this.isDateInRange=this.isDateInRange.bind(this),this.changeSelectingDate=this.changeSelectingDate.bind(this),this.openDateTimePicker=this.openDateTimePicker.bind(this),this.submit=this.submit.bind(this),this.selectingDateFromSummary=null,this.selectingDate="starts"}get htmlTemplate(){return html`
      <style>
        .zcui-wc-date-time-picker-wrapper{width:fit-content;width:-moz-fit-content;outline:none;position:relative}.zcui-wc-date-time-picker{padding:20px;border:solid 1px #cecece;border-radius:5px;margin:auto;min-width:fit-content;min-width:-moz-fit-content;position:absolute;left:0;right:0;border-top:none;background:#fff}.zcui-wc-date-time-picker .d-f{display:flex}.zcui-wc-date-time-picker .fd-c{flex-direction:column}.zcui-wc-date-time-picker .jc-c{justify-content:center}.zcui-wc-date-time-picker .jc-se{justify-content:space-evenly}.zcui-wc-date-time-picker .ai-c{align-items:center}.zcui-wc-date-time-picker .flip-month-page{justify-content:space-around}.zcui-wc-date-time-picker .flip-month-page .left-arrow{border-left:solid 1.5px #6b46bc;border-bottom:solid 1.5px #6b46bc;margin-right:10px;cursor:pointer}.zcui-wc-date-time-picker .flip-month-page .right-arrow{border-right:solid 1.5px #6b46bc;border-top:solid 1.5px #6b46bc;margin-left:10px;cursor:pointer}.zcui-wc-date-time-picker .flip-month-page .arrow{height:12px;width:12px;transform:rotate(45deg)}.zcui-wc-date-time-picker .flip-month-page .arrow.disabled{pointer-events:none;border-color:#cecece}.zcui-wc-date-time-picker .change-month,.zcui-wc-date-time-picker .change-year,.zcui-wc-date-time-picker .change-time{position:relative;cursor:pointer;border:solid 2px #e5e8e9bf;border-radius:5px;padding:5px 10px;margin:0 7px}.zcui-wc-date-time-picker .change-month .down-arrow,.zcui-wc-date-time-picker .change-year .down-arrow,.zcui-wc-date-time-picker .change-time .down-arrow{margin-top:2px;height:8px;width:8px;transform:rotate(45deg);border-right:solid 1.5px #6b46bc;border-bottom:solid 1.5px #6b46bc;margin-left:10px}.zcui-wc-date-time-picker .change-month .month-list,.zcui-wc-date-time-picker .change-month .year-list,.zcui-wc-date-time-picker .change-month .time-list,.zcui-wc-date-time-picker .change-year .month-list,.zcui-wc-date-time-picker .change-year .year-list,.zcui-wc-date-time-picker .change-year .time-list,.zcui-wc-date-time-picker .change-time .month-list,.zcui-wc-date-time-picker .change-time .year-list,.zcui-wc-date-time-picker .change-time .time-list{z-index:1;position:absolute;top:29px;left:0;height:100px;right:0;border:solid 1px #e5e8e9bf;border-top:none;overflow:scroll;padding-top:5px;background:#fff}.zcui-wc-date-time-picker .change-month .month-list span,.zcui-wc-date-time-picker .change-month .year-list span,.zcui-wc-date-time-picker .change-month .time-list span,.zcui-wc-date-time-picker .change-year .month-list span,.zcui-wc-date-time-picker .change-year .year-list span,.zcui-wc-date-time-picker .change-year .time-list span,.zcui-wc-date-time-picker .change-time .month-list span,.zcui-wc-date-time-picker .change-time .year-list span,.zcui-wc-date-time-picker .change-time .time-list span{box-sizing:border-box;padding:5px 10px;width:100%;text-align:left}.zcui-wc-date-time-picker .change-month .month-list span:hover,.zcui-wc-date-time-picker .change-month .year-list span:hover,.zcui-wc-date-time-picker .change-month .time-list span:hover,.zcui-wc-date-time-picker .change-year .month-list span:hover,.zcui-wc-date-time-picker .change-year .year-list span:hover,.zcui-wc-date-time-picker .change-year .time-list span:hover,.zcui-wc-date-time-picker .change-time .month-list span:hover,.zcui-wc-date-time-picker .change-time .year-list span:hover,.zcui-wc-date-time-picker .change-time .time-list span:hover{background:#6b46bc;color:#fff}.zcui-wc-date-time-picker .change-month .month-name,.zcui-wc-date-time-picker .change-year .month-name,.zcui-wc-date-time-picker .change-time .month-name{width:70px}.zcui-wc-date-time-picker .calendar{margin:auto;font-size:14px;width:288px;color:#94979b}.zcui-wc-date-time-picker .calendar .day-name{padding-top:10px;font-size:0}.zcui-wc-date-time-picker .calendar .dates{padding:10px 0;font-size:0}.zcui-wc-date-time-picker .calendar .dates .date-cell{cursor:pointer;border:solid 1px #fff}.zcui-wc-date-time-picker .calendar .dates .date-cell.selected{background:#6b46bc;color:#fff;border-radius:50%}.zcui-wc-date-time-picker .calendar .dates .date-cell.date-in-range{background:#f2f4f7;border-color:#f2f4f7;border-radius:0}.zcui-wc-date-time-picker .calendar .dates .date-cell:hover{border-color:#6b46bc;border-radius:50%}.zcui-wc-date-time-picker .divider{border-bottom:solid 1.5px #e5e8e9bf}.zcui-wc-date-time-picker .date-cell{font-size:14px;display:inline-block;width:40px;text-align:center;padding:10px 0}.zcui-wc-date-time-picker .date-cell.disabled{pointer-events:none;color:#cecece}.zcui-wc-date-time-picker .summary{display:flex;align-items:center}.zcui-wc-date-time-picker .summary .from-summary,.zcui-wc-date-time-picker .summary .to-summary{cursor:pointer;padding:10px 0px}.zcui-wc-date-time-picker .summary .date{width:40px;text-align:right;font-size:40px;padding:0 6px;color:#6b46bc}.zcui-wc-date-time-picker .summary .mon-year-day{width:105px}.zcui-wc-date-time-picker .summary .title{color:#94979b;font-size:12px}.zcui-wc-date-time-picker .summary .selected-day-name{color:#94979b}.zcui-wc-date-time-picker .summary .time-circle{height:20px;width:20px;border:solid 1px #6b46bc;border-radius:50%;margin-left:16px;margin-right:4px}.zcui-wc-date-time-picker .summary .time-circle::after{content:'';display:block;height:8px;width:5px;border-left:solid 1px #6b46bc;border-bottom:solid 1px #6b46bc;margin:4px 0 0 8px}.zcui-wc-date-time-picker .summary .change-time{height:fit-content;height:-moz-fit-content;padding:8px 10px}.zcui-wc-date-time-picker .summary .change-time .down-arrow{margin-top:0}.zcui-wc-date-time-picker .summary .change-time .time-name{width:65px;font-size:15px}.zcui-wc-date-time-picker-display{display:flex;align-items:center;width:fit-content;width:-moz-fit-content;cursor:pointer;border:solid 2px #e5e8e9bf;border-radius:5px;background:#fff}.zcui-wc-date-time-picker-display .starts,.zcui-wc-date-time-picker-display .ends{padding:10px;border-bottom:solid 1px #fff}.zcui-wc-date-time-picker-display .starts.selected,.zcui-wc-date-time-picker-display .ends.selected{border-color:#6b46bc}.hide{display:none}.footer{padding-top:20px;text-align:right}.footer .done{background:#6b46bc;color:#fff;padding:5px 15px;border-radius:6px;cursor:pointer}

      </style>
      <div on-blur=${this.openDateTimePicker(!1)} tabindex="0" class="zcui-wc-date-time-picker-wrapper">

  <div class="zcui-wc-date-time-picker-display" on-click=${this.openDateTimePicker(!0)}>
    <div
      on-click=${this.changeSelectingDate("starts")}
      class$="${"starts"==this.selectingDateFromSummary?"starts selected":"starts"}">
      <span>${this.calendarWeekDays[this.startDateTime.getDay()].substr(0,3)},</span>
      <span>${this.monthNames[this.startDateTime.getMonth()].substr(0,3)}</span>
      <span>${this.startDateTime.getDate()},</span>
      <span>${this.startDateTime.getFullYear()},</span>
      <span class$="${this.canPickTime?"":"hide"}">${this.formatedAMPMTime(this.startDateTime)}</span>
    </div>
    <div class$="${this.canPickEnds?"":"hide"}">â†’</div>
    <div
      on-click=${this.changeSelectingDate("ends")}
      class$="${this.canPickEnds?`${"ends"==this.selectingDateFromSummary?"ends selected":"ends"}`:"hide"}">
      <span>${this.calendarWeekDays[this.endDateTime.getDay()].substr(0,3)},</span>
      <span>${this.monthNames[this.endDateTime.getMonth()].substr(0,3)}</span>
      <span>${this.endDateTime.getDate()},</span>
      <span>${this.endDateTime.getFullYear()},</span>
      <span class$="${this.canPickTime?"":"hide"}">${this.formatedAMPMTime(this.endDateTime)}</span>
    </div>
  </div>
  
  
  <div class$="${this.showDateTimePicker?"zcui-wc-date-time-picker d-f":"hide"}" on-click=${this.closeDropDowns(this)}>
    <div class="flip-month-page d-f ai-c">
      <span
        on-click=${this.setPrevMonth}
        class$="${this.disablePrevMonth?"arrow left-arrow disabled":"arrow left-arrow"}">
      </span>
      <span class="change-month d-f">
        <div class="d-f" on-click=${this.toggleOpenMonthList}>
          <span class="month-name">${this.monthNames[this.selectedMonth]}</span>
          <div class="down-arrow"></div>
        </div>
        <div
          class$="${this.openMonthList?"month-list d-f ai-c fd-c":"hide"}">
          ${repeat(this.monthRangeVal,e=>html`
            <span on-click=${this.selectMonth(e)}>${this.monthNames[e]}</span>
          `)}
        </div>
      </span>
      <span class="change-year d-f">
        <div class="d-f" on-click=${this.toggleOpenYearList}>
          <span class="year-name">${this.selectedYear}</span>
          <div class="down-arrow"></div>
        </div>
        <div class$="${this.openYearList?"year-list d-f ai-c fd-c":"hide"}">
          ${repeat(this.yearRangeVal,e=>html`
            <span on-click=${this.selectYear(e)}>${e}</span>
          `)}
        </div>
      </span>
      <span
        on-click="${this.setNextMonth}"
        class$="${this.disableNextMonth?"arrow right-arrow disabled":"arrow right-arrow"}">
      </span>
    </div>
    <div class="calendar">
      <div class="day-name">
        <span class="date-cell">SU</span>
        <span class="date-cell">MO</span>
        <span class="date-cell">TU</span>
        <span class="date-cell">WE</span>
        <span class="date-cell">TH</span>
        <span class="date-cell">FR</span>
        <span class="date-cell">SA</span>
      </div>
      <div class="divider"></div>
      <!-- (this.endDateOfCalendar-this.startDateOfCalendar+1) will give total dates 
      startDateOfCalendar starts with -ve val or 1 startDateOfCalendar is starts with sunday -->
  
      <div class="dates">
        ${repeat(Array(this.endDateOfCalendar-this.startDateOfCalendar+1).fill(),(e,t)=>html`
          <span
            on-click=${this.selectDate(this.startDateOfCalendar+t)}
            class$="${this.isSelectedDate(this.startDateOfCalendar+t)?"selected date-cell":`${this.isValidDate(this.startDateOfCalendar+t)?`${this.isDateInRange(this.startDateOfCalendar+t)?"date-cell date-in-range":"date-cell"}`:"date-cell disabled"}`}">
            ${this.startDateOfCalendar+t>0?this.startDateOfCalendar+t:""}
          </span>
        `)}
      </div>
    </div>
    <div class$="${this.canPickTime?"divider":"hide"}"></div>
    <div class$="${this.canPickTime?"summary d-f fd-c jc-se":"hide"}">
      <div
        class$="${"starts"==this.selectingDateFromSummary?"from-summary selected-summary":"from-summary"}"
        on-click=${this.changeSelectingDate("starts")}>
        <div class$="${this.canPickEnds?"title":"hide"}">FROM</div>
        <div class="d-f ai-c">
          <div class="date">${this.startDateTime.getDate()}</div>
          <div class="d-f fd-c jc-c mon-year-day">
            <div>
              <span class="month">${this.monthNames[this.startDateTime.getMonth()]}</span>
              <span class="year">${this.startDateTime.getFullYear()}</span>
            </div>
            <div class="selected-day-name">${this.calendarWeekDays[this.startDateTime.getDay()]}</div>
          </div>
          <div class="time-circle"></div>
          <span class="change-time d-f">
            <div class="d-f" on-click=${this.toggleOpenStartTimeList}>
              <span class="time-name">${this.formatedAMPMTime(this.startDateTime)}</span>
              <div class="down-arrow"></div>
            </div>
            <div class$="${this.openStartTimeList?"time-list d-f ai-c fd-c":"hide"}">
              ${repeat(this.timeRangeVal,e=>html`
              <span on-click=${this.selectTime("starts",e)}>${e}</span>
              `)}
            </div>
          </span>
        </div>
      </div>
      <div
        class$="${this.canPickEnds?"to-summary":"hide"}"
        on-click=${this.changeSelectingDate("ends")}>
        <div class="title">TO</div>
        <div class="d-f ai-c">
          <div class="date">${this.endDateTime.getDate()}</div>
          <div class="d-f fd-c jc-c mon-year-day">
            <div>
              <span class="month">${this.monthNames[this.endDateTime.getMonth()]}</span>
              <span class="year">${this.endDateTime.getFullYear()}</span>
            </div>
            <div class="selected-day-name">${this.calendarWeekDays[this.endDateTime.getDay()]}</div>
          </div>
          <div class="time-circle"></div>
          <span class="change-time d-f">
            <div class="d-f" on-click=${this.toggleOpenEndTimeList}>
              <span class="time-name">${this.formatedAMPMTime(this.endDateTime)}</span>
              <div class="down-arrow"></div>
            </div>
            <div class$="${this.openEndTimeList?"time-list d-f ai-c fd-c":"hide"}">
              ${repeat(this.timeRangeVal,e=>html`
              <span on-click=${this.selectTime("ends",e)}>${e}</span>
              `)}
            </div>
          </span>
        </div>
      </div>
    </div>
    <div class="divider"></div>
    <div class="footer">
      <a class="done" on-click=${this.submit}>DONE</a>
    </div>
  </div>
</div>
    `}createShadowDom(){this.attachShadow({mode:"open"}),this.updateShadowDom()}updateShadowDom(){this.shadowRoot&&render(this.htmlTemplate,this.shadowRoot)}attributeChangedCallback(e,t,i){t!=i&&(this.setProps(),this.updateShadowDom())}setProps(){const e=this.getAttribute("max-date-time"),t=this.getAttribute("min-date-time"),i=this.getAttribute("default-starts"),a=this.getAttribute("default-ends");this.maxDateTime=e?new Date(e):new Date((new Date).setMonth((new Date).getMonth()+5)),this.minDateTime=t?new Date(t):new Date((new Date).setMonth((new Date).getMonth()-5)),this.intervalInMin=parseInt(this.getAttribute("interval-in-min")),this.canPickTime="true"==this.getAttribute("time"),this.canPickEnds="true"==this.getAttribute("ends"),this.startDateTime=i?new Date(i):new Date,this.endDateTime=this.canPickEnds&&(a?new Date(a):new Date((new Date).setDate(this.startDateTime.getDate()+5))),this._initializeCalendar(),this._updateCalendarRange(),this._updateTimeRange(),this._flipPage()}_initializeCalendar(){this.selectedMonth=this.startDateTime.getMonth(),this.selectedYear=this.startDateTime.getFullYear(),this.dateRange={from:null,to:null},this.canPickEnds&&(this.dateRange={from:new Date(this.startDateTime),to:new Date(this.endDateTime)})}connectedCallback(){this.createShadowDom()}toggleOpenMonthList(){this.openMonthList=!this.openMonthList,this.updateShadowDom()}toggleOpenYearList(){this.openYearList=!this.openYearList,this.updateShadowDom()}toggleOpenStartTimeList(){this.openStartTimeList=!this.openStartTimeList,this.updateShadowDom()}toggleOpenEndTimeList(){this.openEndTimeList=!this.openEndTimeList,this.updateShadowDom()}selectMonth(e){return()=>{this.selectedMonth=e,this.openMonthList=!1,this._flipPage()}}selectYear(e){return()=>{this.selectedYear=e,this.openYearList=!1,this._updateMonthRange(),this._flipPage()}}selectDate(e){return()=>{if(e<=0)return;const t=new Date(this.selectedYear,this.selectedMonth,e).getTime(),i=new Date(this.startDateTime).getTime(),a=new Date(this.endDateTime).getTime();let s;t>i&&(this.selectingDate=this.selectingDateFromSummary||"ends"),(t<i||t==i||t==a)&&(this.selectingDate="starts"),t>a&&"starts"==this.selectingDateFromSummary&&(this.selectingDate="starts",this.selectingDateFromSummary=null,this.endDateTime=new Date(t)),t<i&&"ends"==this.selectingDateFromSummary&&(this.selectingDate="ends",this.selectingDateFromSummary=null,this.startDateTime=new Date(t)),(s=s="starts"==this.selectingDate?this.startDateTime:this.endDateTime).setDate(e),s.setMonth(this.selectedMonth),s.setYear(this.selectedYear),this.canPickEnds&&(this.dateRange={from:new Date(this.startDateTime),to:new Date(this.endDateTime)}),this._updateTimeRange(),this.updateShadowDom()}}selectTime(e,t){return()=>{const i=t.split(" ")[0].split(":"),a="PM"==t.split(" ")[1]?parseInt(i[0])%12+12:12==i[0]?0:i[0];"starts"==e?(this.startDateTime.setHours(a,i[1]),this.openStartTimeList=!1):(this.endDateTime.setHours(a,i[1]),this.openEndTimeList=!1)}}_updateCalendarRange(){const e=this.maxDateTime.getFullYear(),t=this.minDateTime.getFullYear();if(this.yearRangeVal=Array.apply(null,{length:e-t+1}).map((e,i)=>i+t),e-t<1){const e=this.maxDateTime.getMonth(),t=this.minDateTime.getMonth();this.monthRangeVal=Array.apply(null,{length:e-t+1}).map((e,i)=>i+t)}}setNextMonth(){this.selectedMonth++,12==this.selectedMonth&&(this.selectedMonth=0,this.selectedYear++),this._flipPage()}setPrevMonth(){this.selectedMonth--,-1==this.selectedMonth&&(this.selectedMonth=11,this.selectedYear--),this._flipPage()}_flipPage(){this.startDateOfCalendar=1-new Date(this.selectedYear,this.selectedMonth,1).getDay(),this.endDateOfCalendar=new Date(this.selectedYear,this.selectedMonth+1,0).getDate(),this._checkDisabledNextPrevArrow(),this._updateMonthRange()}_updateMonthRange(){if(this.monthRangeVal=Array.apply(null,{length:12}).map((e,t)=>t),this.selectedYear==this.minDateTime.getFullYear()){const e=this.minDateTime.getMonth();this.selectedMonth<e&&this.startDateTime.setMonth(e),this.monthRangeVal=Array.apply(null,{length:11-e+1}).map((t,i)=>i+e),this.monthRangeVal.includes(this.selectedMonth)||(this.selectedMonth=this.monthRangeVal[0])}if(this.selectedYear==this.maxDateTime.getFullYear()){const e=this.maxDateTime.getMonth();this.selectedMonth>e&&this.startDateTime.setMonth(e),this.monthRangeVal=Array.apply(null,{length:e+1}).map((e,t)=>t),this.monthRangeVal.includes(this.selectedMonth)||(this.selectedMonth=this.monthRangeVal[this.monthRangeVal.length-1])}}closeDropDowns(){return e=>{["month-name","year-name","time-name","down-arrow"].includes(e.path[0].className)||(this.openMonthList=!1,this.openYearList=!1,this.openEndTimeList=!1,this.openStartTimeList=!1,this.updateShadowDom())}}_checkDisabledNextPrevArrow(){this.disableNextMonth=this.disablePrevMonth=!1;let e=new Date(this.minDateTime);e.setYear(this.selectedYear),e.setMonth(this.selectedMonth-1),e<this.minDateTime&&(this.disablePrevMonth=!0);let t=new Date(this.maxDateTime);t.setYear(this.selectedYear),t.setMonth(this.selectedMonth+1),t>this.maxDateTime&&(this.disableNextMonth=!0)}getSelectedDate(e){if(e>0){return new Date(this.selectedYear,this.selectedMonth,e)}}getDateOnly(e){const t=new Date(e.getTime());return t.setHours(0,0,0,0),t}_updateTimeRange(){const e=Math.round(60/this.intervalInMin);this.intervalInMin=60/e;const t=Array.apply(null,{length:e}).map((e,t)=>this.intervalInMin*t),i=new Date(this.minDateTime).setMilliseconds(0),a=new Date(this.maxDateTime).setMilliseconds(0);this.timeRangeVal=Array.apply(null,{length:24*e}).map((s,n)=>{const c=Math.floor(n/e)%24,r=this.getSelectedDate(this.startDateTime.getDate()).setHours(c,t[n%e],0);if(r<i||r>a)return null;const d=c<12?"AM":"PM";return`${c%12?c%12:12}:${n%e?t[n%e]:"00"} ${d}`}).filter(e=>e)}isSelectedDate(e){return this.getSelectedDate(e)&&this.getDateOnly(this.startDateTime).getTime()==this.getSelectedDate(e).getTime()||this.endDateTime&&this.getSelectedDate(e)&&this.canPickEnds&&this.getDateOnly(this.endDateTime).getTime()==this.getSelectedDate(e).getTime()}isValidDate(e){if(e<=0)return!1;const t=new Date(this.minDateTime).setHours(0,0,0,0),i=new Date(this.maxDateTime).setHours(0,0,0,0),a=this.getSelectedDate(e).setHours(0,0,0,0);return!(a<t||a>i)}formatedAMPMTime(e){let t=e.getHours(),i=e.getMinutes();const a=t>=12?"PM":"AM";return(t=(t%=12)||12)+":"+(i=i<10?"0"+i:i)+" "+a}isDateInRange(e){if(!this.dateRange.from||!this.dateRange.to)return!1;const t=this.getSelectedDate(e).setHours(0,0,0,0),i=this.dateRange.from.setHours(0,0,0,0),a=this.dateRange.to.setHours(0,0,0,0);return t>i&&t<a}changeSelectingDate(e){return()=>{this.selectingDateFromSummary=e}}openDateTimePicker(e){return()=>{this.showDateTimePicker=e,this.updateShadowDom()}}submit(){this.dispatchEvent(new CustomEvent("done",{detail:{from:this.startDateTime,to:this.canPickEnds&&this.endDateTime},bubbles:!0})),this.showDateTimePicker=!1,this.updateShadowDom()}}window.customElements.define("zcui-wc-date-time-picker",ZcuiWcDateTimePicker);
